# 网络基础

#### TCP基础
##### TCP的三次握手和四次挥手
三次握手

1. SYN，客户端向服务端发送一个带有SYN标志的连接请求报文。请求建立链接，此时客户端进入SYN_SENT状态
2. SYN+ACK，服务端收到客户端响应后，表示接收连接请求。同时服务器也会为该连接分配缓冲区和变量，进入SYN_RCVD状态
3. ACK，客户端受到服务端响应后，向服务端发送一个带有ACK标志的报文，表示正式确认连接。此时客户端和服务端都进入ESTABLISHED状态，连接正式建立。

四次挥手

1. FIN，当一方决定断开连接时，发送一个带有FIN的报文给对方。发送方进入FIN_WAIT_1状态
2. ACK，当对方接收到关闭请求后，发送一个带有ACK的报文作为响应，表示确认关闭请求。此时接收方进入CLOSE_WAIT状态，发送方进入FIN_WAIT_2状态
3. FIN，接收方也决定关闭连接时，发送一个带有FIN的报文给发送方。此时接收方进入LAST_ACK状态
4. ACK，发送方接收到关闭请求后，发送一个带有给ACK的报文段作为响应。关闭连接后，双方进入CLOSE状态。
##### TCP三次握手和四次挥手的设计目的

1. 确保双方的收发能力
2. 防止已经失效的连接请求被接收
3. 防止网络延迟导致的重复连接
4. 安全性考虑，通过四次挥手，保证数据都已经传送完毕

#### HTTP/HTTPS
##### HTTP2基础
HTTP2是2015年发布的HTTP新版本，它具有以下的新特性

1. 多路复用，即允许在同一个TCP连接上同时传输多个请求和响应。这意味着可以并行发送多个请求，而不需要按顺序等待响应，提高性能减少延迟
2. 二进制分帧，将数据拆分成更小的帧，并采用二进制的格式进行传输，可以更高效的利用网络带宽，减少开销和延迟
3. 头部压缩，使用了一种HPACK的压缩算法，减少请求和响应头部的大小
4. 服务器推送，允许服务器主动推送资源
5. 优先级，允许给每个请求设置优先级，提高关键资源的加载速度
6. 流量控制，防止发送方发送过多的数据导致接收方无法处理
##### 如何开启HTTP2

1. 使用HTTPS，HTTP2只支持HTTPS
2. 需要保证服务器端支持HTTP2，包括Nginx，Apache
3. 更新服务配置文件，如Nginx的`listen 443 ssl http2`
4. 保证浏览器的支持

可以通过开发者工具中Network查看请求协议版本是否为HTTP/2

##### HTTPS基础
HTTPS是将HTTP建立在TLS加密层上的协议。

HTTPS有两种，一种是单向验证，即只有客户端验证服务端的证书的合法性，一种是双向验证，即客户端需要安装证书，客户端和服务端会相互验证对方整数的合法性。

浏览器验证HTTPS证书的原理，每一个浏览器都会内置了一系列信任证书，这些证书一般是对应着证书颁发机构。需要使用HTTPS，就需要从这些证书颁发机构申请证书，浏览器会通过证书的公钥以及其他信息，比对内置的证书链来确认证书的合法性。用户也可以自己生成证书，但自行生成的证书不受浏览器承认，访问者可以通过将证书加入浏览器的证书信任链中解决。

HTTPS构建的过程，HTTPS建立连接经历两个阶段，非对称加密和对称加密。浏览器发起一个HTTPS请求，服务端会返回一个证书，浏览器在确认证书合法性后，利用证书中的公钥生成一个对称密钥并发送给服务端，此时进行的是非对称加密，即仅有浏览器利用公钥加密发送数据，但没有接收加密数据，服务端利用私钥解密得到这个对称密钥后，双方进行对称加密通信，即双方使用对称密钥进行通信和加密解密。
